<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content=
  "width=device-width,initial-scale=1,maximum-scale=1.0, user-scalable=no">
  
    <title></title>
    <style>
    body {
      margin: 0;
    }
        .img {
            display: inline-block;
        }
        .frames img {
            width: 64px;
        }
        canvas {
            touch-action: none;
            user-select: none;
        }
        #result {
            position: fixed;
            right: 0;
            bottom: 0;
            max-width: 50%;
            max-height: 50%;
        }
    </style>
</head>
<body>
    <p>
        define matching points on both images (in same order)
        <input type="checkbox" id="erase" />Erase
    </p>
    <div class="img">
        <canvas id="canvas1" width="600" height="600"></canvas><br>
        <input type="button" class="clear" value="clear points" target="canvas1">
        <input type="file" target="canvas1">
    </div>
    <div class="img">
        <canvas id="canvas2" width="600"  height="600"></canvas><br>
        <input type="button" class="clear" value="clear points" target="canvas2">
        <input type="file" target="canvas2">
    </div>

    <div class="img">
        <canvas id="result" width="600" height="600"></canvas><br>
        <input type="text" id="frames" value="1">
        <input type="checkbox" id="blend"/>Blend
        <input type="checkbox" id="animate" onchange="if(this.value===false){document.getElementById('blend').value=false;}"/>Animate
        <input type="button" id="generate" value="generate">
        <input type="button" onclick="drawing=!drawing;draw();" value="draw">
    </div>

    <div>
        <img id="gif">
    </div>

    <div id="frameset" class="frames"></div>
  
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="./imgwarp.js"></script>
    <script>

        var warper = {};
        var loadImg = function(target, canvas, img) {
            var n = target.slice(-1);
            var ratio = canvas.width / img.width;      // set canvas size big enough for the image
            canvas.height = img.height*ratio
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img,0,0, img.width, img.height, 0, 0, canvas.width, canvas.height);

            img.width = canvas.width;
            img.height = canvas.height;
            var imageData = ctx.getImageData(0, 0, img.width, img.height);
            if (warper[target]) delete warper[target];
            warper[target] = new ImgWarper.PointDefiner(canvas, img, imageData);
        };
        
        const slices = 16;
        const stacks = 8;
        
        function vertex(theta, phi, w, h) {
          
          var x = w * theta;
          var y = h/2 + h/2 * Math.sin(theta*4) / Math.sqrt( Math.pow(Math.sin(theta*4),2) + Math.pow(phi,2) )

          return {"x":x, "y":y};
        }

        var img1 = new Image();
        img1.onload = function() {
            var img = img1;
            var target = 'canvas1';
            var canvas = document.getElementById(target);
            loadImg(target, canvas, img);
            
            /*var points = [];
            for (var j = 0; j < stacks; j++) {
              for (var i = 0; i < slices; i++) {
                points.push(vertex(i / slices, j / stacks, img.width, img.height));
                points[points.length-1] = new ImgWarper.Point(points[points.length-1].x, points[points.length-1].y);
              }
            }*/
            
            var points = [{"x":24,"y":428},{"x":50,"y":344},{"x":86,"y":263},{"x":141,"y":186},{"x":255,"y":119},{"x":767,"y":118},{"x":883,"y":185},{"x":939,"y":262},{"x":974,"y":343},{"x":1001,"y":427},{"x":1024,"y":512},{"x":1047,"y":596},{"x":1073,"y":680},{"x":1108,"y":761},{"x":1164,"y":838},{"x":1278,"y":905},{"x":1790,"y":906},{"x":1906,"y":839},{"x":1962,"y":762},{"x":1997,"y":681},{"x":2024,"y":597},{"x":2048,"y":504},{"x":1,"y":512},{"x":50,"y":429},{"x":105,"y":350},{"x":171,"y":280},{"x":256,"y":224},{"x":370,"y":185},{"x":653,"y":185},{"x":767,"y":223},{"x":853,"y":279},{"x":920,"y":349},{"x":974,"y":428},{"x":1073,"y":595},{"x":1128,"y":674},{"x":1194,"y":744},{"x":1279,"y":800},{"x":1393,"y":839},{"x":1676,"y":839},{"x":1790,"y":801},{"x":1876,"y":745},{"x":1943,"y":675},{"x":1998,"y":596},{"x":86,"y":430},{"x":170,"y":362},{"x":256,"y":312},{"x":256,"y":312},{"x":341,"y":280},{"x":427,"y":262},{"x":597,"y":262},{"x":683,"y":280},{"x":768,"y":312},{"x":769,"y":312},{"x":853,"y":361},{"x":938,"y":429},{"x":1109,"y":594},{"x":1193,"y":662},{"x":1279,"y":712},{"x":1279,"y":712},{"x":1364,"y":744},{"x":1450,"y":762},{"x":1620,"y":762},{"x":1706,"y":744},{"x":1791,"y":712},{"x":1792,"y":712},{"x":1876,"y":663},{"x":1961,"y":595},{"x":142,"y":435},{"x":256,"y":386},{"x":341,"y":362},{"x":407,"y":349},{"x":462,"y":344},{"x":562,"y":343},{"x":616,"y":349},{"x":682,"y":361},{"x":768,"y":386},{"x":881,"y":434},{"x":1024,"y":512},{"x":1165,"y":589},{"x":1279,"y":638},{"x":1364,"y":662},{"x":1430,"y":675},{"x":1485,"y":680},{"x":1585,"y":681},{"x":1639,"y":675},{"x":1705,"y":663},{"x":1791,"y":638},{"x":1904,"y":590},{"x":2047,"y":512},{"x":254,"y":452},{"x":369,"y":435},{"x":427,"y":430},{"x":462,"y":428},{"x":489,"y":427},{"x":535,"y":427},{"x":562,"y":428},{"x":597,"y":430},{"x":653,"y":435},{"x":766,"y":451},{"x":1023,"y":512},{"x":1277,"y":572},{"x":1392,"y":589},{"x":1449,"y":594},{"x":1485,"y":596},{"x":1512,"y":597},{"x":1558,"y":597},{"x":1585,"y":596},{"x":1620,"y":594},{"x":1676,"y":589},{"x":1789,"y":573},{"x":2046,"y":512},{"x":6,"y":512},{"x":12,"y":512},{"x":18,"y":512},{"x":24,"y":512},{"x":30,"y":512},{"x":36,"y":512},{"x":42,"y":512},{"x":48,"y":512},{"x":54,"y":512},{"x":60,"y":512},{"x":66,"y":512},{"x":72,"y":512},{"x":78,"y":512},{"x":84,"y":512},{"x":90,"y":512},{"x":96,"y":512},{"x":102,"y":512},{"x":108,"y":512},{"x":114,"y":512},{"x":120,"y":512},{"x":126,"y":512},{"x":132,"y":512},{"x":138,"y":512},{"x":144,"y":512},{"x":150,"y":512},{"x":156,"y":512},{"x":162,"y":512},{"x":168,"y":512},{"x":174,"y":512},{"x":180,"y":512},{"x":186,"y":512},{"x":192,"y":512},{"x":198,"y":512},{"x":204,"y":512},{"x":210,"y":512},{"x":216,"y":512},{"x":222,"y":512},{"x":228,"y":512},{"x":234,"y":512},{"x":240,"y":512},{"x":246,"y":512},{"x":252,"y":512},{"x":258,"y":512},{"x":264,"y":512},{"x":270,"y":512},{"x":276,"y":512},{"x":282,"y":512},{"x":288,"y":512},{"x":294,"y":512},{"x":300,"y":512},{"x":306,"y":512},{"x":312,"y":512},{"x":318,"y":512},{"x":324,"y":512},{"x":330,"y":512},{"x":336,"y":512},{"x":342,"y":512},{"x":348,"y":512},{"x":354,"y":512},{"x":360,"y":512},{"x":366,"y":512},{"x":372,"y":512},{"x":378,"y":512},{"x":384,"y":512},{"x":390,"y":512},{"x":396,"y":512},{"x":402,"y":512},{"x":408,"y":512},{"x":414,"y":512},{"x":420,"y":512},{"x":426,"y":512},{"x":432,"y":512},{"x":438,"y":512},{"x":444,"y":512},{"x":450,"y":512},{"x":456,"y":512},{"x":462,"y":512},{"x":468,"y":512},{"x":474,"y":512},{"x":480,"y":512},{"x":486,"y":512},{"x":492,"y":512},{"x":498,"y":512},{"x":504,"y":512},{"x":510,"y":512},{"x":516,"y":512},{"x":522,"y":512},{"x":528,"y":512},{"x":534,"y":512},{"x":540,"y":512},{"x":546,"y":512},{"x":552,"y":512},{"x":558,"y":512},{"x":564,"y":512},{"x":570,"y":512},{"x":576,"y":512},{"x":582,"y":512},{"x":588,"y":512},{"x":594,"y":512},{"x":600,"y":512},{"x":606,"y":512},{"x":612,"y":512},{"x":618,"y":512},{"x":624,"y":512},{"x":630,"y":512},{"x":636,"y":512},{"x":642,"y":512},{"x":648,"y":512},{"x":654,"y":512},{"x":660,"y":512},{"x":666,"y":512},{"x":672,"y":512},{"x":678,"y":512},{"x":684,"y":512},{"x":690,"y":512},{"x":696,"y":512},{"x":702,"y":512},{"x":708,"y":512},{"x":714,"y":512},{"x":720,"y":512},{"x":726,"y":512},{"x":732,"y":512},{"x":738,"y":512},{"x":744,"y":512},{"x":750,"y":512},{"x":756,"y":512},{"x":762,"y":512},{"x":768,"y":512},{"x":774,"y":512},{"x":780,"y":512},{"x":786,"y":512},{"x":792,"y":512},{"x":798,"y":512},{"x":804,"y":512},{"x":810,"y":512},{"x":816,"y":512},{"x":822,"y":512},{"x":828,"y":512},{"x":834,"y":512},{"x":840,"y":512},{"x":846,"y":512},{"x":852,"y":512},{"x":858,"y":512},{"x":864,"y":512},{"x":870,"y":512},{"x":876,"y":512},{"x":882,"y":512},{"x":888,"y":512},{"x":894,"y":512},{"x":900,"y":512},{"x":906,"y":512},{"x":912,"y":512},{"x":918,"y":512},{"x":924,"y":512},{"x":930,"y":512},{"x":936,"y":512},{"x":942,"y":512},{"x":948,"y":512},{"x":954,"y":512},{"x":960,"y":512},{"x":966,"y":512},{"x":972,"y":512},{"x":978,"y":512},{"x":984,"y":512},{"x":990,"y":512},{"x":996,"y":512},{"x":1002,"y":512},{"x":1008,"y":512},{"x":1014,"y":512},{"x":1020,"y":512},{"x":1029,"y":512},{"x":1035,"y":512},{"x":1041,"y":512},{"x":1047,"y":512},{"x":1053,"y":512},{"x":1059,"y":512},{"x":1065,"y":512},{"x":1071,"y":512},{"x":1077,"y":512},{"x":1083,"y":512},{"x":1089,"y":512},{"x":1095,"y":512},{"x":1101,"y":512},{"x":1107,"y":512},{"x":1113,"y":512},{"x":1119,"y":512},{"x":1125,"y":512},{"x":1131,"y":512},{"x":1137,"y":512},{"x":1143,"y":512},{"x":1149,"y":512},{"x":1155,"y":512},{"x":1161,"y":512},{"x":1167,"y":512},{"x":1173,"y":512},{"x":1179,"y":512},{"x":1185,"y":512},{"x":1191,"y":512},{"x":1197,"y":512},{"x":1203,"y":512},{"x":1209,"y":512},{"x":1215,"y":512},{"x":1221,"y":512},{"x":1227,"y":512},{"x":1233,"y":512},{"x":1239,"y":512},{"x":1245,"y":512},{"x":1251,"y":512},{"x":1257,"y":512},{"x":1263,"y":512},{"x":1269,"y":512},{"x":1275,"y":512},{"x":1281,"y":512},{"x":1287,"y":512},{"x":1293,"y":512},{"x":1299,"y":512},{"x":1305,"y":512},{"x":1311,"y":512},{"x":1317,"y":512},{"x":1323,"y":512},{"x":1329,"y":512},{"x":1335,"y":512},{"x":1341,"y":512},{"x":1347,"y":512},{"x":1353,"y":512},{"x":1359,"y":512},{"x":1365,"y":512},{"x":1371,"y":512},{"x":1377,"y":512},{"x":1383,"y":512},{"x":1389,"y":512},{"x":1395,"y":512},{"x":1401,"y":512},{"x":1407,"y":512},{"x":1413,"y":512},{"x":1419,"y":512},{"x":1425,"y":512},{"x":1431,"y":512},{"x":1437,"y":512},{"x":1443,"y":512},{"x":1449,"y":512},{"x":1455,"y":512},{"x":1461,"y":512},{"x":1467,"y":512},{"x":1473,"y":512},{"x":1479,"y":512},{"x":1485,"y":512},{"x":1491,"y":512},{"x":1497,"y":512},{"x":1503,"y":512},{"x":1509,"y":512},{"x":1515,"y":512},{"x":1521,"y":512},{"x":1527,"y":512},{"x":1533,"y":512},{"x":1539,"y":512},{"x":1545,"y":512},{"x":1551,"y":512},{"x":1557,"y":512},{"x":1563,"y":512},{"x":1569,"y":512},{"x":1575,"y":512},{"x":1581,"y":512},{"x":1587,"y":512},{"x":1593,"y":512},{"x":1599,"y":512},{"x":1605,"y":512},{"x":1611,"y":512},{"x":1617,"y":512},{"x":1623,"y":512},{"x":1629,"y":512},{"x":1635,"y":512},{"x":1641,"y":512},{"x":1647,"y":512},{"x":1653,"y":512},{"x":1659,"y":512},{"x":1665,"y":512},{"x":1671,"y":512},{"x":1677,"y":512},{"x":1683,"y":512},{"x":1689,"y":512},{"x":1695,"y":512},{"x":1701,"y":512},{"x":1707,"y":512},{"x":1713,"y":512},{"x":1719,"y":512},{"x":1725,"y":512},{"x":1731,"y":512},{"x":1737,"y":512},{"x":1743,"y":512},{"x":1749,"y":512},{"x":1755,"y":512},{"x":1761,"y":512},{"x":1767,"y":512},{"x":1773,"y":512},{"x":1779,"y":512},{"x":1785,"y":512},{"x":1791,"y":512},{"x":1797,"y":512},{"x":1803,"y":512},{"x":1809,"y":512},{"x":1815,"y":512},{"x":1821,"y":512},{"x":1827,"y":512},{"x":1833,"y":512},{"x":1839,"y":512},{"x":1845,"y":512},{"x":1851,"y":512},{"x":1857,"y":512},{"x":1863,"y":512},{"x":1869,"y":512},{"x":1875,"y":512},{"x":1881,"y":512},{"x":1887,"y":512},{"x":1893,"y":512},{"x":1899,"y":512},{"x":1905,"y":512},{"x":1911,"y":512},{"x":1917,"y":512},{"x":1923,"y":512},{"x":1929,"y":512},{"x":1935,"y":512},{"x":1941,"y":512},{"x":1947,"y":512},{"x":1953,"y":512},{"x":1959,"y":512},{"x":1965,"y":512},{"x":1971,"y":512},{"x":1977,"y":512},{"x":1983,"y":512},{"x":1989,"y":512},{"x":1995,"y":512},{"x":2001,"y":512},{"x":2007,"y":512},{"x":2013,"y":512},{"x":2019,"y":512},{"x":2025,"y":512},{"x":2031,"y":512},{"x":2037,"y":512},{"x":2043,"y":512},{"x":254,"y":572},{"x":369,"y":589},{"x":427,"y":594},{"x":462,"y":596},{"x":489,"y":597},{"x":535,"y":597},{"x":562,"y":596},{"x":597,"y":594},{"x":653,"y":589},{"x":766,"y":573},{"x":1277,"y":452},{"x":1392,"y":435},{"x":1449,"y":430},{"x":1485,"y":428},{"x":1512,"y":427},{"x":1558,"y":427},{"x":1585,"y":428},{"x":1620,"y":430},{"x":1676,"y":435},{"x":1789,"y":451},{"x":142,"y":589},{"x":256,"y":638},{"x":341,"y":662},{"x":407,"y":675},{"x":462,"y":680},{"x":562,"y":681},{"x":616,"y":675},{"x":682,"y":663},{"x":768,"y":638},{"x":881,"y":590},{"x":1165,"y":435},{"x":1279,"y":386},{"x":1364,"y":362},{"x":1430,"y":349},{"x":1485,"y":344},{"x":1585,"y":343},{"x":1639,"y":349},{"x":1705,"y":361},{"x":1791,"y":386},{"x":1904,"y":434},{"x":86,"y":594},{"x":170,"y":662},{"x":256,"y":712},{"x":256,"y":712},{"x":341,"y":744},{"x":427,"y":762},{"x":597,"y":762},{"x":683,"y":744},{"x":768,"y":712},{"x":769,"y":712},{"x":853,"y":663},{"x":938,"y":595},{"x":1109,"y":430},{"x":1193,"y":362},{"x":1279,"y":312},{"x":1279,"y":312},{"x":1364,"y":280},{"x":1450,"y":262},{"x":1620,"y":262},{"x":1706,"y":280},{"x":1791,"y":312},{"x":1792,"y":312},{"x":1876,"y":361},{"x":1961,"y":429},{"x":50,"y":595},{"x":105,"y":674},{"x":171,"y":744},{"x":256,"y":800},{"x":370,"y":839},{"x":653,"y":839},{"x":767,"y":801},{"x":853,"y":745},{"x":920,"y":675},{"x":974,"y":596},{"x":1073,"y":429},{"x":1128,"y":350},{"x":1194,"y":280},{"x":1279,"y":224},{"x":1393,"y":185},{"x":1676,"y":185},{"x":1790,"y":223},{"x":1876,"y":279},{"x":1943,"y":349},{"x":1998,"y":428},{"x":24,"y":596},{"x":50,"y":680},{"x":86,"y":761},{"x":141,"y":838},{"x":255,"y":905},{"x":767,"y":906},{"x":883,"y":839},{"x":939,"y":762},{"x":974,"y":681},{"x":1001,"y":597},{"x":1047,"y":428},{"x":1073,"y":344},{"x":1108,"y":263},{"x":1164,"y":186},{"x":1278,"y":119},{"x":1790,"y":118},{"x":1906,"y":185},{"x":1962,"y":262},{"x":1997,"y":343},{"x":2024,"y":427}];
            //var points = JSON.parse('[{"x":193,"y":216},{"x":226,"y":212},{"x":260,"y":219},{"x":306,"y":218},{"x":338,"y":208},{"x":370,"y":215},{"x":206,"y":239},{"x":226,"y":235},{"x":249,"y":240},{"x":314,"y":240},{"x":340,"y":234},{"x":361,"y":241},{"x":265,"y":313},{"x":297,"y":314},{"x":236,"y":360},{"x":282,"y":361},{"x":325,"y":360},{"x":251,"y":427},{"x":316,"y":428},{"x":165,"y":256},{"x":407,"y":253},{"x":199,"y":112},{"x":354,"y":103},{"x":188,"y":332},{"x":383,"y":328},{"x":211,"y":376},{"x":356,"y":383},{"x":124,"y":403},{"x":444,"y":405},{"x":178,"y":46},{"x":397,"y":49}]');
            for (var x = 0; x < points.length; x++) {
                points[x] = new ImgWarper.Point(points[x].x, points[x].y);
            }
            warper[target].oriPoints = points;
            warper[target].dstPoints = points;
            warper[target].redraw();

        };
        img1.src = "img/face1.jpg";

        var img2 = new Image();
        img2.onload = function(img) {
            var img = img2;
            var target = 'canvas2';
            var canvas = document.getElementById(target);
            loadImg(target, canvas, img);
            
            /*var points = [];
            for (var j = 0; j < stacks; j++) {
              for (var i = 0; i < slices; i++) {
                points.push(vertex(i / slices, j / stacks, img.width, img.height));
                points[points.length-1] = new ImgWarper.Point(points[points.length-1].x, points[points.length-1].y);
              }
            }*/
            
            var points = [{"x":24,"y":428},{"x":50,"y":344},{"x":86,"y":263},{"x":141,"y":186},{"x":255,"y":119},{"x":767,"y":118},{"x":883,"y":185},{"x":939,"y":262},{"x":974,"y":343},{"x":1001,"y":427},{"x":1024,"y":512},{"x":1047,"y":596},{"x":1073,"y":680},{"x":1108,"y":761},{"x":1164,"y":838},{"x":1278,"y":905},{"x":1790,"y":906},{"x":1906,"y":839},{"x":1962,"y":762},{"x":1997,"y":681},{"x":2024,"y":597},{"x":2048,"y":504},{"x":1,"y":512},{"x":50,"y":429},{"x":105,"y":350},{"x":171,"y":280},{"x":256,"y":224},{"x":370,"y":185},{"x":653,"y":185},{"x":767,"y":223},{"x":853,"y":279},{"x":920,"y":349},{"x":974,"y":428},{"x":1073,"y":595},{"x":1128,"y":674},{"x":1194,"y":744},{"x":1279,"y":800},{"x":1393,"y":839},{"x":1676,"y":839},{"x":1790,"y":801},{"x":1876,"y":745},{"x":1943,"y":675},{"x":1998,"y":596},{"x":86,"y":430},{"x":170,"y":362},{"x":256,"y":312},{"x":256,"y":312},{"x":341,"y":280},{"x":427,"y":262},{"x":597,"y":262},{"x":683,"y":280},{"x":768,"y":312},{"x":769,"y":312},{"x":853,"y":361},{"x":938,"y":429},{"x":1109,"y":594},{"x":1193,"y":662},{"x":1279,"y":712},{"x":1279,"y":712},{"x":1364,"y":744},{"x":1450,"y":762},{"x":1620,"y":762},{"x":1706,"y":744},{"x":1791,"y":712},{"x":1792,"y":712},{"x":1876,"y":663},{"x":1961,"y":595},{"x":142,"y":435},{"x":256,"y":386},{"x":341,"y":362},{"x":407,"y":349},{"x":462,"y":344},{"x":562,"y":343},{"x":616,"y":349},{"x":682,"y":361},{"x":768,"y":386},{"x":881,"y":434},{"x":1024,"y":512},{"x":1165,"y":589},{"x":1279,"y":638},{"x":1364,"y":662},{"x":1430,"y":675},{"x":1485,"y":680},{"x":1585,"y":681},{"x":1639,"y":675},{"x":1705,"y":663},{"x":1791,"y":638},{"x":1904,"y":590},{"x":2047,"y":512},{"x":254,"y":452},{"x":369,"y":435},{"x":427,"y":430},{"x":462,"y":428},{"x":489,"y":427},{"x":535,"y":427},{"x":562,"y":428},{"x":597,"y":430},{"x":653,"y":435},{"x":766,"y":451},{"x":1023,"y":512},{"x":1277,"y":572},{"x":1392,"y":589},{"x":1449,"y":594},{"x":1485,"y":596},{"x":1512,"y":597},{"x":1558,"y":597},{"x":1585,"y":596},{"x":1620,"y":594},{"x":1676,"y":589},{"x":1789,"y":573},{"x":2046,"y":512},{"x":6,"y":512},{"x":12,"y":512},{"x":18,"y":512},{"x":24,"y":512},{"x":30,"y":512},{"x":36,"y":512},{"x":42,"y":512},{"x":48,"y":512},{"x":54,"y":512},{"x":60,"y":512},{"x":66,"y":512},{"x":72,"y":512},{"x":78,"y":512},{"x":84,"y":512},{"x":90,"y":512},{"x":96,"y":512},{"x":102,"y":512},{"x":108,"y":512},{"x":114,"y":512},{"x":120,"y":512},{"x":126,"y":512},{"x":132,"y":512},{"x":138,"y":512},{"x":144,"y":512},{"x":150,"y":512},{"x":156,"y":512},{"x":162,"y":512},{"x":168,"y":512},{"x":174,"y":512},{"x":180,"y":512},{"x":186,"y":512},{"x":192,"y":512},{"x":198,"y":512},{"x":204,"y":512},{"x":210,"y":512},{"x":216,"y":512},{"x":222,"y":512},{"x":228,"y":512},{"x":234,"y":512},{"x":240,"y":512},{"x":246,"y":512},{"x":252,"y":512},{"x":258,"y":512},{"x":264,"y":512},{"x":270,"y":512},{"x":276,"y":512},{"x":282,"y":512},{"x":288,"y":512},{"x":294,"y":512},{"x":300,"y":512},{"x":306,"y":512},{"x":312,"y":512},{"x":318,"y":512},{"x":324,"y":512},{"x":330,"y":512},{"x":336,"y":512},{"x":342,"y":512},{"x":348,"y":512},{"x":354,"y":512},{"x":360,"y":512},{"x":366,"y":512},{"x":372,"y":512},{"x":378,"y":512},{"x":384,"y":512},{"x":390,"y":512},{"x":396,"y":512},{"x":402,"y":512},{"x":408,"y":512},{"x":414,"y":512},{"x":420,"y":512},{"x":426,"y":512},{"x":432,"y":512},{"x":438,"y":512},{"x":444,"y":512},{"x":450,"y":512},{"x":456,"y":512},{"x":462,"y":512},{"x":468,"y":512},{"x":474,"y":512},{"x":480,"y":512},{"x":486,"y":512},{"x":492,"y":512},{"x":498,"y":512},{"x":504,"y":512},{"x":510,"y":512},{"x":516,"y":512},{"x":522,"y":512},{"x":528,"y":512},{"x":534,"y":512},{"x":540,"y":512},{"x":546,"y":512},{"x":552,"y":512},{"x":558,"y":512},{"x":564,"y":512},{"x":570,"y":512},{"x":576,"y":512},{"x":582,"y":512},{"x":588,"y":512},{"x":594,"y":512},{"x":600,"y":512},{"x":606,"y":512},{"x":612,"y":512},{"x":618,"y":512},{"x":624,"y":512},{"x":630,"y":512},{"x":636,"y":512},{"x":642,"y":512},{"x":648,"y":512},{"x":654,"y":512},{"x":660,"y":512},{"x":666,"y":512},{"x":672,"y":512},{"x":678,"y":512},{"x":684,"y":512},{"x":690,"y":512},{"x":696,"y":512},{"x":702,"y":512},{"x":708,"y":512},{"x":714,"y":512},{"x":720,"y":512},{"x":726,"y":512},{"x":732,"y":512},{"x":738,"y":512},{"x":744,"y":512},{"x":750,"y":512},{"x":756,"y":512},{"x":762,"y":512},{"x":768,"y":512},{"x":774,"y":512},{"x":780,"y":512},{"x":786,"y":512},{"x":792,"y":512},{"x":798,"y":512},{"x":804,"y":512},{"x":810,"y":512},{"x":816,"y":512},{"x":822,"y":512},{"x":828,"y":512},{"x":834,"y":512},{"x":840,"y":512},{"x":846,"y":512},{"x":852,"y":512},{"x":858,"y":512},{"x":864,"y":512},{"x":870,"y":512},{"x":876,"y":512},{"x":882,"y":512},{"x":888,"y":512},{"x":894,"y":512},{"x":900,"y":512},{"x":906,"y":512},{"x":912,"y":512},{"x":918,"y":512},{"x":924,"y":512},{"x":930,"y":512},{"x":936,"y":512},{"x":942,"y":512},{"x":948,"y":512},{"x":954,"y":512},{"x":960,"y":512},{"x":966,"y":512},{"x":972,"y":512},{"x":978,"y":512},{"x":984,"y":512},{"x":990,"y":512},{"x":996,"y":512},{"x":1002,"y":512},{"x":1008,"y":512},{"x":1014,"y":512},{"x":1020,"y":512},{"x":1029,"y":512},{"x":1035,"y":512},{"x":1041,"y":512},{"x":1047,"y":512},{"x":1053,"y":512},{"x":1059,"y":512},{"x":1065,"y":512},{"x":1071,"y":512},{"x":1077,"y":512},{"x":1083,"y":512},{"x":1089,"y":512},{"x":1095,"y":512},{"x":1101,"y":512},{"x":1107,"y":512},{"x":1113,"y":512},{"x":1119,"y":512},{"x":1125,"y":512},{"x":1131,"y":512},{"x":1137,"y":512},{"x":1143,"y":512},{"x":1149,"y":512},{"x":1155,"y":512},{"x":1161,"y":512},{"x":1167,"y":512},{"x":1173,"y":512},{"x":1179,"y":512},{"x":1185,"y":512},{"x":1191,"y":512},{"x":1197,"y":512},{"x":1203,"y":512},{"x":1209,"y":512},{"x":1215,"y":512},{"x":1221,"y":512},{"x":1227,"y":512},{"x":1233,"y":512},{"x":1239,"y":512},{"x":1245,"y":512},{"x":1251,"y":512},{"x":1257,"y":512},{"x":1263,"y":512},{"x":1269,"y":512},{"x":1275,"y":512},{"x":1281,"y":512},{"x":1287,"y":512},{"x":1293,"y":512},{"x":1299,"y":512},{"x":1305,"y":512},{"x":1311,"y":512},{"x":1317,"y":512},{"x":1323,"y":512},{"x":1329,"y":512},{"x":1335,"y":512},{"x":1341,"y":512},{"x":1347,"y":512},{"x":1353,"y":512},{"x":1359,"y":512},{"x":1365,"y":512},{"x":1371,"y":512},{"x":1377,"y":512},{"x":1383,"y":512},{"x":1389,"y":512},{"x":1395,"y":512},{"x":1401,"y":512},{"x":1407,"y":512},{"x":1413,"y":512},{"x":1419,"y":512},{"x":1425,"y":512},{"x":1431,"y":512},{"x":1437,"y":512},{"x":1443,"y":512},{"x":1449,"y":512},{"x":1455,"y":512},{"x":1461,"y":512},{"x":1467,"y":512},{"x":1473,"y":512},{"x":1479,"y":512},{"x":1485,"y":512},{"x":1491,"y":512},{"x":1497,"y":512},{"x":1503,"y":512},{"x":1509,"y":512},{"x":1515,"y":512},{"x":1521,"y":512},{"x":1527,"y":512},{"x":1533,"y":512},{"x":1539,"y":512},{"x":1545,"y":512},{"x":1551,"y":512},{"x":1557,"y":512},{"x":1563,"y":512},{"x":1569,"y":512},{"x":1575,"y":512},{"x":1581,"y":512},{"x":1587,"y":512},{"x":1593,"y":512},{"x":1599,"y":512},{"x":1605,"y":512},{"x":1611,"y":512},{"x":1617,"y":512},{"x":1623,"y":512},{"x":1629,"y":512},{"x":1635,"y":512},{"x":1641,"y":512},{"x":1647,"y":512},{"x":1653,"y":512},{"x":1659,"y":512},{"x":1665,"y":512},{"x":1671,"y":512},{"x":1677,"y":512},{"x":1683,"y":512},{"x":1689,"y":512},{"x":1695,"y":512},{"x":1701,"y":512},{"x":1707,"y":512},{"x":1713,"y":512},{"x":1719,"y":512},{"x":1725,"y":512},{"x":1731,"y":512},{"x":1737,"y":512},{"x":1743,"y":512},{"x":1749,"y":512},{"x":1755,"y":512},{"x":1761,"y":512},{"x":1767,"y":512},{"x":1773,"y":512},{"x":1779,"y":512},{"x":1785,"y":512},{"x":1791,"y":512},{"x":1797,"y":512},{"x":1803,"y":512},{"x":1809,"y":512},{"x":1815,"y":512},{"x":1821,"y":512},{"x":1827,"y":512},{"x":1833,"y":512},{"x":1839,"y":512},{"x":1845,"y":512},{"x":1851,"y":512},{"x":1857,"y":512},{"x":1863,"y":512},{"x":1869,"y":512},{"x":1875,"y":512},{"x":1881,"y":512},{"x":1887,"y":512},{"x":1893,"y":512},{"x":1899,"y":512},{"x":1905,"y":512},{"x":1911,"y":512},{"x":1917,"y":512},{"x":1923,"y":512},{"x":1929,"y":512},{"x":1935,"y":512},{"x":1941,"y":512},{"x":1947,"y":512},{"x":1953,"y":512},{"x":1959,"y":512},{"x":1965,"y":512},{"x":1971,"y":512},{"x":1977,"y":512},{"x":1983,"y":512},{"x":1989,"y":512},{"x":1995,"y":512},{"x":2001,"y":512},{"x":2007,"y":512},{"x":2013,"y":512},{"x":2019,"y":512},{"x":2025,"y":512},{"x":2031,"y":512},{"x":2037,"y":512},{"x":2043,"y":512},{"x":254,"y":572},{"x":369,"y":589},{"x":427,"y":594},{"x":462,"y":596},{"x":489,"y":597},{"x":535,"y":597},{"x":562,"y":596},{"x":597,"y":594},{"x":653,"y":589},{"x":766,"y":573},{"x":1277,"y":452},{"x":1392,"y":435},{"x":1449,"y":430},{"x":1485,"y":428},{"x":1512,"y":427},{"x":1558,"y":427},{"x":1585,"y":428},{"x":1620,"y":430},{"x":1676,"y":435},{"x":1789,"y":451},{"x":142,"y":589},{"x":256,"y":638},{"x":341,"y":662},{"x":407,"y":675},{"x":462,"y":680},{"x":562,"y":681},{"x":616,"y":675},{"x":682,"y":663},{"x":768,"y":638},{"x":881,"y":590},{"x":1165,"y":435},{"x":1279,"y":386},{"x":1364,"y":362},{"x":1430,"y":349},{"x":1485,"y":344},{"x":1585,"y":343},{"x":1639,"y":349},{"x":1705,"y":361},{"x":1791,"y":386},{"x":1904,"y":434},{"x":86,"y":594},{"x":170,"y":662},{"x":256,"y":712},{"x":256,"y":712},{"x":341,"y":744},{"x":427,"y":762},{"x":597,"y":762},{"x":683,"y":744},{"x":768,"y":712},{"x":769,"y":712},{"x":853,"y":663},{"x":938,"y":595},{"x":1109,"y":430},{"x":1193,"y":362},{"x":1279,"y":312},{"x":1279,"y":312},{"x":1364,"y":280},{"x":1450,"y":262},{"x":1620,"y":262},{"x":1706,"y":280},{"x":1791,"y":312},{"x":1792,"y":312},{"x":1876,"y":361},{"x":1961,"y":429},{"x":50,"y":595},{"x":105,"y":674},{"x":171,"y":744},{"x":256,"y":800},{"x":370,"y":839},{"x":653,"y":839},{"x":767,"y":801},{"x":853,"y":745},{"x":920,"y":675},{"x":974,"y":596},{"x":1073,"y":429},{"x":1128,"y":350},{"x":1194,"y":280},{"x":1279,"y":224},{"x":1393,"y":185},{"x":1676,"y":185},{"x":1790,"y":223},{"x":1876,"y":279},{"x":1943,"y":349},{"x":1998,"y":428},{"x":24,"y":596},{"x":50,"y":680},{"x":86,"y":761},{"x":141,"y":838},{"x":255,"y":905},{"x":767,"y":906},{"x":883,"y":839},{"x":939,"y":762},{"x":974,"y":681},{"x":1001,"y":597},{"x":1047,"y":428},{"x":1073,"y":344},{"x":1108,"y":263},{"x":1164,"y":186},{"x":1278,"y":119},{"x":1790,"y":118},{"x":1906,"y":185},{"x":1962,"y":262},{"x":1997,"y":343},{"x":2024,"y":427}];
            //var points = JSON.parse('[{"x":191,"y":228},{"x":217,"y":217},{"x":268,"y":233},{"x":335,"y":231},{"x":383,"y":222},{"x":410,"y":229},{"x":214,"y":258},{"x":240,"y":253},{"x":262,"y":258},{"x":340,"y":260},{"x":363,"y":253},{"x":390,"y":257},{"x":285,"y":339},{"x":322,"y":337},{"x":256,"y":379},{"x":302,"y":381},{"x":348,"y":379},{"x":270,"y":453},{"x":324,"y":454},{"x":160,"y":273},{"x":440,"y":274},{"x":242,"y":122},{"x":345,"y":121},{"x":190,"y":375},{"x":413,"y":373},{"x":221,"y":411},{"x":385,"y":411},{"x":150,"y":433},{"x":444,"y":435},{"x":200,"y":69},{"x":415,"y":69}]');
            for (var x = 0; x < points.length; x++) {
                points[x] = new ImgWarper.Point(points[x].x, points[x].y);
            }
            warper[target].oriPoints = points;
            warper[target].dstPoints = points;
            warper[target].redraw();
        };
        img2.src = "img/face2.jpg";

        $("input.clear").click(function() {
            var target = $(this).attr('target');
            warper[target].oriPoints = [];
            warper[target].dstPoints = [];
            warper[target].redraw();
        });

        $("input[type=file]").on("change", function() {
            var file = this.files[0];
            var fr = new FileReader();
            var target = $(this).attr('target');
            var canvas=document.getElementById(target);
            fr.onload = function() {
                var img = new Image();
                img.onload = function() { loadImg(target, canvas, img); };
                img.src = fr.result
            };;
            fr.readAsDataURL(file)
        });

        var animator = null;
        var frames = [];
        function generateFrames() {
            // get points from both images
            animator = new ImgWarper.Animator(warper['canvas1'], warper['canvas2']);
            animator.generate($("#frames").val());

            if (document.getElementById("animate").checked) {
              $("#frameset").empty();
            }
            draw_all();
        }
        $("#generate").click(generateFrames);

        var play_frame = 0;
        var direction = true;
        var res_c = document.getElementById("result");
        var res_ctx = res_c.getContext('2d');
        var cnt = 0;
        var drawing = false;
        var intv = null;

        function draw_all() {
            frames = animator.frames;

            for (var x = 0; x < frames.length; x++) {
                res_ctx.putImageData(frames[x],0,0);
                if (document.getElementById("animate").checked) {
                  var image = document.createElement("img");
                  image.src = res_c.toDataURL("image/png");
                  $(".frames").append(image);
                }
            }

        }

        function draw() {
            res_ctx.putImageData(frames[play_frame],0,0);
            play_frame = direction ? play_frame + 1 : play_frame - 1;
            if (play_frame == 0 || play_frame == frames.length - 1) direction = !direction;

            if (drawing === true) {
                intv = setTimeout(window.requestAnimationFrame(draw), 40);
            } else {
                clearTimeout(intv);
            }
        }
        
    </script>
</body>
</html>
